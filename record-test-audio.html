<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Record Test Audio Samples</title>
    <style>
      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        max-width: 800px;
        margin: 40px auto;
        padding: 20px;
        background: #f5f5f5;
      }
      .container {
        background: white;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      h1 {
        color: #333;
        margin-bottom: 10px;
      }
      .subtitle {
        color: #666;
        margin-bottom: 30px;
      }
      button {
        background: #4caf50;
        color: white;
        border: none;
        padding: 12px 24px;
        font-size: 16px;
        border-radius: 4px;
        cursor: pointer;
        margin: 5px;
      }
      button:hover {
        background: #45a049;
      }
      button:disabled {
        background: #ccc;
        cursor: not-allowed;
      }
      .recording {
        background: #f44336;
      }
      .recording:hover {
        background: #da190b;
      }
      .play-btn {
        background: #2196f3;
      }
      .play-btn:hover {
        background: #0b7dda;
      }
      .download-btn {
        background: #ff9800;
      }
      .download-btn:hover {
        background: #e68900;
      }
      .recording-item {
        background: #f9f9f9;
        padding: 15px;
        margin: 10px 0;
        border-radius: 4px;
        border-left: 4px solid #4caf50;
      }
      .recording-item h3 {
        margin: 0 0 10px 0;
        color: #333;
      }
      .status {
        padding: 15px;
        margin: 20px 0;
        border-radius: 4px;
        font-weight: bold;
        text-align: center;
      }
      .status.idle {
        background: #e3f2fd;
        color: #1976d2;
      }
      .status.recording {
        background: #ffebee;
        color: #c62828;
        animation: pulse 1s infinite;
      }
      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.7;
        }
      }
      .instructions {
        background: #fff3cd;
        padding: 15px;
        border-radius: 4px;
        margin-bottom: 20px;
        border-left: 4px solid #ffc107;
      }
      .instructions h3 {
        margin-top: 0;
        color: #856404;
      }
      .instructions ol {
        margin: 10px 0;
        padding-left: 20px;
      }
      .instructions li {
        margin: 5px 0;
        color: #856404;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üéôÔ∏è Record Test Audio Samples</h1>
      <p class="subtitle">Record 5-6 audio samples to use for automated testing</p>

      <div class="instructions">
        <h3>üìã Instructions:</h3>
        <ol>
          <li>Click "Start Recording" and speak for 3-5 seconds</li>
          <li>Click "Stop Recording" when done</li>
          <li>Play back to verify the recording</li>
          <li>Download the recording (it will save as WebM format)</li>
          <li>Repeat 5-6 times with different phrases</li>
        </ol>
        <p><strong>Suggested phrases:</strong></p>
        <ul>
          <li>"Hello, my name is Wayne and I'm testing the audio system"</li>
          <li>"Can you hear me clearly? I'm speaking into the microphone"</li>
          <li>"This is a test recording for the Hume EVI integration"</li>
          <li>"I want to make sure the audio quality is good"</li>
          <li>"Let's see if this works properly with the voice recognition"</li>
        </ul>
      </div>

      <div id="status" class="status idle">Ready to record</div>

      <div style="text-align: center; margin: 20px 0">
        <button id="startBtn" onclick="startRecording()">üé§ Start Recording</button>
        <button id="stopBtn" onclick="stopRecording()" disabled class="recording">
          ‚èπÔ∏è Stop Recording
        </button>
      </div>

      <h3>Recorded Samples:</h3>
      <div id="recordings"></div>
    </div>

    <script>
      let mediaRecorder = null;
      let mediaStream = null;
      let recordedChunks = [];
      let recordings = [];
      let recordingNumber = 1;

      async function startRecording() {
        try {
          // Get microphone access
          if (!mediaStream) {
            mediaStream = await navigator.mediaDevices.getUserMedia({ audio: true });
          }

          recordedChunks = [];

          // Use WebM format (same as what we send to Hume)
          const mimeType = MediaRecorder.isTypeSupported('audio/webm') ? 'audio/webm' : 'audio/ogg';

          mediaRecorder = new MediaRecorder(mediaStream, { mimeType });

          mediaRecorder.ondataavailable = (event) => {
            if (event.data.size > 0) {
              recordedChunks.push(event.data);
            }
          };

          mediaRecorder.onstop = () => {
            const blob = new Blob(recordedChunks, { type: mimeType });
            const url = URL.createObjectURL(blob);

            recordings.push({
              number: recordingNumber,
              blob: blob,
              url: url,
              mimeType: mimeType,
              size: blob.size,
              timestamp: new Date().toLocaleTimeString(),
            });

            displayRecordings();
            recordingNumber++;

            updateStatus('Recording saved! Ready for next recording', 'idle');
          };

          mediaRecorder.start();

          document.getElementById('startBtn').disabled = true;
          document.getElementById('stopBtn').disabled = false;
          updateStatus('üî¥ RECORDING... Speak now!', 'recording');
        } catch (error) {
          alert('Error accessing microphone: ' + error.message);
          console.error(error);
        }
      }

      function stopRecording() {
        if (mediaRecorder && mediaRecorder.state !== 'inactive') {
          mediaRecorder.stop();
          document.getElementById('startBtn').disabled = false;
          document.getElementById('stopBtn').disabled = true;
        }
      }

      function updateStatus(text, className) {
        const statusDiv = document.getElementById('status');
        statusDiv.textContent = text;
        statusDiv.className = `status ${className}`;
      }

      function displayRecordings() {
        const container = document.getElementById('recordings');
        container.innerHTML = '';

        recordings.forEach((recording, index) => {
          const div = document.createElement('div');
          div.className = 'recording-item';
          div.innerHTML = `
          <h3>Recording ${recording.number}</h3>
          <p>
            <strong>Time:</strong> ${recording.timestamp} |
            <strong>Size:</strong> ${(recording.size / 1024).toFixed(2)} KB |
            <strong>Format:</strong> ${recording.mimeType}
          </p>
          <audio controls src="${recording.url}" style="width: 100%; margin: 10px 0;"></audio>
          <button class="play-btn" onclick="playRecording(${index})">‚ñ∂Ô∏è Play</button>
          <button class="download-btn" onclick="downloadRecording(${index})">üíæ Download</button>
        `;
          container.appendChild(div);
        });
      }

      function playRecording(index) {
        const audio = new Audio(recordings[index].url);
        audio.play();
      }

      function downloadRecording(index) {
        const recording = recordings[index];
        const filename = `test-audio-${recording.number}.webm`;
        const a = document.createElement('a');
        a.href = recording.url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);

        // Show alert with download location
        setTimeout(() => {
          alert(
            `‚úÖ Downloaded: ${filename}\n\nCheck your Downloads folder:\n/Users/wph/Downloads/\n\nYou can now use this file in the test page!`
          );
        }, 500);
      }

      // Cleanup on page unload
      window.addEventListener('beforeunload', () => {
        if (mediaStream) {
          mediaStream.getTracks().forEach((track) => track.stop());
        }
      });
    </script>
  </body>
</html>
